<app-navbar class="fixed top-0 left-0 w-full z-50 shadow-md"></app-navbar>

<div class="min-h-[85vh] bg-gray-50 flex flex-col items-center py-10 px-4 mt-11">
  <div class="bg-white shadow-lg rounded-2xl p-6 w-full max-w-5xl">
    <!-- Título del curso -->
    <div class="flex items-center justify-start gap-3 mb-6">
      <!-- Botón de volver -->
      <button (click)="irAtras()"
        class="flex items-center justify-center w-10 h-10 rounded-full bg-gray-100 hover:bg-gray-200 text-gray-700 transition-all shadow-sm"
        title="Volver al curso">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="w-5 h-5 text-gray-700">
          <path fill-rule="evenodd"
            d="M15.78 4.22a.75.75 0 010 1.06L9.06 12l6.72 6.72a.75.75 0 11-1.06 1.06l-7.25-7.25a.75.75 0 010-1.06l7.25-7.25a.75.75 0 011.06 0z"
            clip-rule="evenodd" />
        </svg>
      </button>

      <!-- Título y subtítulo -->
      <div class="text-left">
        <h2 class="text-xl font-bold text-gray-800 mb-2">Añadir materias al curso</h2>

        <p *ngIf="cursoSeleccionado" class="text-lg text-indigo-700 font-semibold">
          Curso: {{ cursoSeleccionado.nombre }} - {{ cursoSeleccionado.nivel }}°{{ cursoSeleccionado.paralelo }}
        </p>

        <p *ngIf="!cursoSeleccionado" class="text-gray-500 italic">
          Cargando información del curso...
        </p>
      </div>
    </div>


    <!-- Barra superior (combo + botones) -->
    <div class="flex justify-between mt-4 mb-4">
      <div class="flex items-center gap-3">
        <!-- Combo box de materias predefinidas -->
        <select id="materiaBase"
          class="px-3 py-2 border rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500"
          (change)="onMateriaSeleccionada($event)">
          <option value="">-- Selecciona materia --</option>
          <option *ngFor="let materia of materiasBasicas" [value]="materia.nombre">
            {{ materia.nombre }}
          </option>
        </select>

        <button type="button" (click)="agregarFila()"
          class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg transition">
          Añadir fila
        </button>
      </div>

      <!-- 🔧 Botón fuera del form pero asociado por id -->
      <button type="submit" form="materiasForm"
        class="bg-indigo-600 hover:bg-indigo-700 text-white px-6 py-2 rounded-lg transition">
        Guardar materias
      </button>
    </div>

    <!-- Formulario -->
    <form [formGroup]="materiasForm" (ngSubmit)="onSubmit()" id="materiasForm" class="space-y-4">
      <div formArrayName="materias">
        <div *ngFor="let materia of materias.controls; let i = index" [formGroupName]="i"
          class="grid grid-cols-12 gap-4 items-center mb-3 border-b pb-3">
          <div class="col-span-4">
            <label class="block text-sm font-medium text-gray-700 mb-1">Nombre</label>
            <input type="text" formControlName="nombre" placeholder="Nombre de la materia"
              class="w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500" />
          </div>

          <div class="col-span-6">
            <label class="block text-sm font-medium text-gray-700 mb-1">Descripción</label>
            <input type="text" formControlName="descripcion" placeholder="Descripción de la materia"
              class="w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500" />
          </div>

          <div class="col-span-2 flex items-end justify-center">
            <button type="button" (click)="eliminarFila(i)" class="text-red-600 hover:text-red-700 font-semibold"
              [disabled]="materias.length === 1">
              Eliminar
            </button>
          </div>
        </div>
      </div>
    </form>

    <!-- Tabla de materias (sin cambios) -->
    <div class="mt-4">
      <h3 class="text-lg font-semibold text-gray-800 mb-4 text-center">
        Materias registradas
      </h3>

      <div class="overflow-x-auto rounded-2xl shadow-md border border-gray-200">
        <table class="min-w-full border-collapse">
          <thead class="bg-gradient-to-r from-indigo-600 to-indigo-500 text-white text-sm uppercase tracking-wide">
            <tr>
              <th class="p-3 text-left w-12">#</th>
              <th class="p-3 text-left">Nombre</th>
              <th class="p-3 text-left">Descripción</th>
            </tr>
          </thead>

          <tbody class="divide-y divide-gray-100 bg-white text-gray-700">
            <tr *ngFor="let m of materiasLista; let i = index"
              class="hover:bg-indigo-50/70 transition-all duration-150 ease-in-out">
              <td class="p-3 font-medium text-gray-600">{{ i + 1 }}</td>
              <td class="p-3">{{ m.nombre }}</td>
              <td class="p-3 text-gray-600">{{ m.descripcion }}</td>
            </tr>

            <tr *ngIf="materiasLista.length === 0">
              <td colspan="3" class="text-center text-gray-500 p-4 italic">
                No hay materias registradas.
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>

  </div>
</div>