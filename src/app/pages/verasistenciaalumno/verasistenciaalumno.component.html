<app-navbar class="fixed top-0 left-0 w-full z-50 shadow-md"></app-navbar>

<!-- üîπ Vista: lista de cursos -->
<div *ngIf="!cursoSeleccionado" class="min-h-[85vh] bg-gray-50 flex flex-col items-center py-10 px-6 mt-10">
    <div class="bg-white shadow-xl rounded-2xl p-8 w-full max-w-6xl border border-gray-100">
        <h2 class="text-2xl font-bold text-indigo-700 mb-8 text-center md:text-left">
            Mis cursos asignados:
        </h2>

        <div *ngIf="cursos.length > 0; else noCursos" class="grid gap-8"
            style="grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));">

            <div *ngFor="let curso of cursos" (click)="verAsistencia(curso.id || curso._id)"
                class="cursor-pointer border border-gray-200 rounded-2xl p-8 shadow-md hover:shadow-2xl transition-all flex flex-col justify-between hover:bg-indigo-50">
                <p class="text-xl font-semibold text-gray-800 mb-3 text-center">
                    {{ curso.nombre }} - {{ curso.nivel }}¬∞{{ curso.paralelo }}
                </p>
            </div>
        </div>

        <ng-template #noCursos>
            <div class="flex justify-center items-center">
                <div class="border border-gray-200 bg-white rounded-2xl shadow-md p-8 max-w-md text-center">
                    <p class="text-2xl font-semibold text-gray-700 mb-2">
                        No est√°s inscrito en ning√∫n curso
                    </p>
                    <p class="text-gray-500 text-sm">
                        A√∫n no est√°s inscrito en ning√∫n curso.<br>
                        Contacta a tu docente o administrador para recibir una asignaci√≥n.
                    </p>
                </div>
            </div>
        </ng-template>
    </div>
</div>

<!-- üîπ Vista: historial del curso -->
<div *ngIf="cursoSeleccionado" class="bg-gray-50 flex flex-col items-center py-10 px-4 mt-10">
    <div class="bg-white shadow-xl rounded-2xl p-6 w-full max-w-6xl border border-gray-100">

        <!-- Encabezado -->
        <div class="flex items-center justify-center gap-3 text-center mb-6">
            <button (click)="irAtras()"
                class="flex items-center justify-center w-10 h-10 rounded-full bg-gray-100 hover:bg-gray-200 text-gray-700 transition-all shadow-sm"
                title="Volver a cursos">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"
                    class="w-5 h-5 text-gray-700">
                    <path fill-rule="evenodd"
                        d="M15.78 4.22a.75.75 0 010 1.06L9.06 12l6.72 6.72a.75.75 0 11-1.06 1.06l-7.25-7.25a.75.75 0 010-1.06l7.25-7.25a.75.75 0 011.06 0z"
                        clip-rule="evenodd" />
                </svg>
            </button>

            <div>
                <h2 class="text-2xl font-extrabold text-gray-800 mb-1">
                    Historial de asistencia
                </h2>
                <p class="text-indigo-700 text-lg font-semibold">
                    {{ cursoSeleccionado?.nombre }} - {{ cursoSeleccionado?.nivel }}¬∞{{ cursoSeleccionado?.paralelo }}
                </p>
            </div>
        </div>

        <!-- Resumen general -->
        <div *ngIf="resumen" class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-6 text-center">
            <div class="bg-indigo-50 rounded-xl p-4 shadow-sm">
                <p class="text-sm text-gray-600">Total registros</p>
                <p class="text-xl font-bold text-indigo-700">{{ resumen.total }}</p>
            </div>
            <div class="bg-green-50 rounded-xl p-4 shadow-sm">
                <p class="text-sm text-gray-600">Presentes</p>
                <p class="text-xl font-bold text-green-600">{{ resumen.presentes }}</p>
            </div>
            <div class="bg-red-50 rounded-xl p-4 shadow-sm">
                <p class="text-sm text-gray-600">Ausentes</p>
                <p class="text-xl font-bold text-red-600">{{ resumen.ausentes }}</p>
            </div>
            <div class="bg-blue-50 rounded-xl p-4 shadow-sm">
                <p class="text-sm text-gray-600">Justificados</p>
                <p class="text-xl font-bold text-blue-600">{{ resumen.justificados }}</p>
            </div>
        </div>

        <!-- Tabla del historial -->
        <div *ngIf="!cargando && historial.length > 0" class="overflow-hidden border border-gray-200 rounded-xl">
            <table class="min-w-full border-collapse">
                <thead class="bg-indigo-600 text-white text-sm uppercase tracking-wide">
                    <tr>
                        <th class="p-3 text-left w-12">#</th>
                        <th class="p-3 text-center">Fecha</th>
                        <th class="p-3 text-center">Estado</th>
                    </tr>
                </thead>
                <tbody class="divide-y divide-gray-100 bg-white text-gray-700">
                    <tr *ngFor="let r of historial; let i = index" class="hover:bg-indigo-50 transition-all">
                        <td class="p-3 text-gray-600 font-medium">{{ i + 1 }}</td>
                        <td class="p-3 text-center">{{ r.fecha | date:'dd/MM/yyyy' }}</td>
                        <td class="p-3 text-center font-semibold" [ngClass]="{
                  'text-green-600': r.estado === 'Presente',
                  'text-red-600': r.estado === 'Ausente',
                  'text-blue-600 italic': r.estado === 'Justificado'
                }">
                            {{ r.estado }}
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>

        <!-- Sin registros -->
        <div *ngIf="!cargando && historial.length === 0" class="text-center text-gray-500 py-10">
            No se encontraron registros de asistencia para este curso.
        </div>

        <!-- Cargando -->
        <div *ngIf="cargando" class="text-center text-gray-500 py-10">
            Cargando historial...
        </div>
    </div>
</div>