<app-navbar class="fixed top-0 left-0 w-full z-50 shadow-md"></app-navbar>

<div class="bg-gray-50 py-10 px-10 mt-11" *ngIf="!cargando && data">
    <!-- Encabezado con botón -->
    <div class="flex justify-between items-center mb-10">

        <div class="flex items-center gap-3">
            <!-- Botón atrás -->
            <button (click)="irAtras()"
                class="flex items-center justify-center w-10 h-10 rounded-full bg-gray-100 hover:bg-gray-200 text-gray-700 transition-all shadow-sm"
                title="Volver a trimestres">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"
                    class="w-5 h-5 text-gray-700">
                    <path fill-rule="evenodd"
                        d="M15.78 4.22a.75.75 0 010 1.06L9.06 12l6.72 6.72a.75.75 0 11-1.06 1.06l-7.25-7.25a.75.75 0 010-1.06l7.25-7.25a.75.75 0 011.06 0z"
                        clip-rule="evenodd" />
                </svg>
            </button>

            <!-- Título -->
            <h2 class="text-2xl font-bold text-indigo-700">
                {{ data.materia }} — {{ data.curso }}
            </h2>
        </div>


        <!-- El botón solo visible si el usuario es docente -->
        <button *ngIf="esDocente" (click)="crearTrimestres()"
            class="bg-indigo-600 hover:bg-indigo-700 text-white font-semibold px-5 py-2.5 rounded-xl shadow-md transition-all flex items-center gap-2">
            <i class="fa-solid fa-layer-group"></i>
            Crear cartillas del Trimestre
        </button>
    </div>

    <!-- Tarjetas de trimestres -->
    <div class="grid gap-8" style="grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));">
        <div *ngFor="let key of ['trimestre_1', 'trimestre_2', 'trimestre_3']; let i = index"
            class="border border-gray-200 rounded-2xl p-8 shadow-md hover:shadow-lg transition-all bg-white hover:-translate-y-1 active:scale-95 cursor-pointer"
            [routerLink]="esDocente
                ? ['/materias', materiaId, 'trimestre', i + 1, 'estudiantes']
                : ['/materias', materiaId, 'trimestre', i + 1, 'detalle']
            ">
            <h3 class="text-xl font-semibold text-gray-800 text-center mb-4">
                {{ key.replace('_', ' ').toUpperCase() }}
            </h3>

            <ng-container *ngIf="data.trimestres[key].existe; else noCreado">
                <div class="text-center py-2 px-4 rounded-xl font-medium mb-3" [ngClass]="{
                        'bg-green-100 text-green-700':
                        data.trimestres[key].estado === 'cerrado',
                        'bg-yellow-100 text-yellow-700':
                        data.trimestres[key].estado === 'abierto'
                    }">
                    Estado: {{ data.trimestres[key].estado | titlecase }}
                </div>

                <p class="text-center" [ngClass]="{
                        'text-green-600 font-medium':
                        data.trimestres[key].estado === 'cerrado',
                        'text-yellow-600 font-medium':
                        data.trimestres[key].estado === 'abierto'
                    }">
                    {{ data.trimestres[key].mensaje }}
                </p>

                <p class="text-sm text-gray-600 text-center mt-2">
                    {{ data.trimestres[key].cantidad }} registros encontrados.
                </p>
            </ng-container>

            <ng-template #noCreado>
                <p class="text-red-500 text-center italic">
                    {{ data.trimestres[key].mensaje }}
                </p>
            </ng-template>
        </div>
    </div>
</div>

<div *ngIf="error" class="text-center text-red-600 mt-20">
    {{ error }}
</div>